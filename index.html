<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ö–ª–∏–∫–µ—Ä –ú–æ–Ω–µ—Ç–∞</title>
<meta name="description" content="–ò–≥—Ä–∞ –ö–ª–∏–∫–µ—Ä –ú–æ–Ω–µ—Ç–∞ - –Ω–∞–∂–∏–º–∞–π –Ω–∞ –º–æ–Ω–µ—Ç—É –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –æ—á–∫–∏!">
<meta name="keywords" content="–∏–≥—Ä–∞, –∫–ª–∏–∫–µ—Ä, –º–æ–Ω–µ—Ç–∞, Telegram, Web App">
<meta name="author" content="–í–∞—à–µ –ò–º—è">
<style>
  body {
    text-align: center;
    font-family: Arial, sans-serif;
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    background: url('LeadtexFon.png') no-repeat center center fixed;
    background-size: cover;
    color: white; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –±–µ–ª—ã–π */
  }
  .coin {
    width: 300px;
    height: 300px;
    background: url('LeadtexCoin.png') no-repeat center center;
    background-size: contain;
    cursor: pointer;
    margin: 0 auto;
    margin-top: 120px;
    transition: transform 0.05s, box-shadow 0.05s; /* –£—Å–∫–æ—Ä—è–µ–º –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ */
    user-select: none;
    outline: none; /* –£–±–∏—Ä–∞–µ–º –æ–±–≤–æ–¥–∫—É –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
    -webkit-tap-highlight-color: transparent; /* –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
    border-radius: 50%; /* –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –∫—Ä—É–≥–ª–æ–π */
  }
  .coin.active {
    transform: scale(0.96);
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  }
  #balance {
    position: absolute;
    top: 100px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 24px;
    z-index: 10;
    color: white; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –±–µ–ª—ã–π */
  }
  #user-info {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 18px;
    color: white; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –±–µ–ª—ã–π */
  }
  .click-animation {
    position: absolute;
    font-size: 36px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ –Ω–∞ 50% */
    color: white;
    animation: fadeUp 1s ease-out forwards;
    pointer-events: none; /* –û—Ç–∫–ª—é—á–∞–µ–º —Å–æ–±—ã—Ç–∏—è –º—ã—à–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
  }
  @keyframes fadeUp {
    0% {
      opacity: 1;
      transform: translateY(0);
    }
    100% {
      opacity: 0;
      transform: translateY(-50px);
    }
  }
</style>
</head>
<body>
<div id="user-info">ID: <span id="userId"></span><br>Username: <span id="username"></span></div>
<div class="coin" id="coin"></div>
<div id="balance">üí≤ 0</div>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
let balance = 0;
let telegramId = null;

async function vibrateOnClick() {
  if ("vibrate" in navigator) {
    window.navigator.vibrate(100); // –ö–æ—Ä–æ—Ç–∫–∞—è –≤–∏–±—Ä–∞—Ü–∏—è –Ω–∞ 100 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
  }
}

async function incrementScore(event) {
  balance++;
  document.getElementById('balance').textContent = 'üí≤' + balance;
  await showClickAnimation(event.clientX, event.clientY);
}

async function showClickAnimation(x, y) {
  const clickText = document.createElement('div');
  clickText.textContent = '+1';
  clickText.className = 'click-animation';
  clickText.style.left = `${x}px`;
  clickText.style.top = `${y}px`;
  document.body.appendChild(clickText);
  await new Promise(resolve => setTimeout(resolve, 1000));
  clickText.remove();
}

function setInitialBalance(initialBalance) {
  balance = initialBalance;
  document.getElementById('balance').textContent = 'üí≤' + balance;
}

function fetchInitialBalance(telegramId) {
  const webhookUrl = 'https://hook.eu2.make.com/3cn7hflf2x478ihdcm38gjgw2rbu5ioa';

  fetch(webhookUrl, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      telegram_id: telegramId
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data && data.data && data.data[0] && data.data[0].balance !== undefined) {
      const initialBalance = data.data[0].balance;
      setInitialBalance(initialBalance);
    } else {
      alert('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: ' + JSON.stringify(data));
    }
  })
  .catch(error => {
    alert('–û—à–∏–±–∫–∞: ' + error);
  });
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Telegram Web App
if (window.Telegram && window.Telegram.WebApp) {
  alert("Telegram Web App detected");
  Telegram.WebApp.expand();
  Telegram.WebApp.enableClosingConfirmation();
  const initDataUnsafe = Telegram.WebApp.initDataUnsafe;
  alert("initDataUnsafe: " + JSON.stringify(initDataUnsafe));
  if (initDataUnsafe && initDataUnsafe.user) {
    telegramId = initDataUnsafe.user.id;
    document.getElementById('userId').textContent = telegramId;
    document.getElementById('username').textContent = initDataUnsafe.user.username;
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
    fetchInitialBalance(telegramId);
    window.Telegram.WebApp.MainButton.setParams({
      text: "–ó–∞–∫—Ä—ã—Ç—å",
      color: "rgb(77, 76, 76)",
      text_color: "#FFFFFF"
    });
    window.Telegram.WebApp.MainButton.show();
    window.Telegram.WebApp.MainButton.onClick(function() {
      const url = `https://app.leadteh.ru/w/bQ300?utm_campaign=${balance}`;
      window.Telegram.WebApp.openLink(url);
      window.Telegram.WebApp.close();
    });
  } else {
    alert("initDataUnsafe.user is undefined");
  }
} else {
  alert("Telegram Web App not detected");
}

function handleTouchStart(event) {
  event.preventDefault();
  const coin = document.getElementById('coin');
  const rect = coin.getBoundingClientRect();
  Array.from(event.touches).forEach(async touch => {
    if (touch.clientX >= rect.left && touch.clientX <= rect.right && touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
      await incrementScore(touch);
      await vibrateOnClick();
      coin.classList.add('active');
      setTimeout(() => coin.classList.remove('active'), 50); // –£—Å–∫–æ—Ä—è–µ–º –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
    }
  });
}

function handleMouseDown(event) {
  event.preventDefault();
  const coin = document.getElementById('coin');
  const rect = coin.getBoundingClientRect();
  if (event.clientX >= rect.left && event.clientX <= rect.right && event.clientY >= rect.top && event.clientY <= rect.bottom) {
    incrementScore(event);
    vibrateOnClick();
    coin.classList.add('active');
    setTimeout(() => coin.classList.remove('active'), 50); // –£—Å–∫–æ—Ä—è–µ–º –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
  }
}

document.getElementById('coin').addEventListener('mousedown', handleMouseDown);
document.getElementById('coin').addEventListener('touchstart', handleTouchStart);

// –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞ —Å–º–∞—Ö–∏–≤–∞–Ω–∏–µ–º –≤–Ω–∏–∑
if (window.Telegram && window.Telegram.WebApp) {
  Telegram.WebApp.onEvent('viewportChanged', function() {
    if (Telegram.WebApp.viewportStableHeight !== window.innerHeight) {
      Telegram.WebApp.expand();
    }
  });
}
</script>
</body>
</html>
