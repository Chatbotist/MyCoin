<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ö–ª–∏–∫–µ—Ä –ú–æ–Ω–µ—Ç–∞</title>
<style>
  body {
    text-align: center;
    font-family: Arial, sans-serif;
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    background: #333333;
    color: white; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –±–µ–ª—ã–π */
  }
  .coin {
    background-color: #4CAF50;
    border-radius: 50%;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    width: 300px;
    height: 300px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 32px;
    color: white;
    cursor: pointer;
    margin: 0 auto;
    margin-top: 120px;
    transition: background-color 0.1s;
    user-select: none;
  }
  .coin:active {
    background-color: #388E3C;
    transform: scale(0.96);
    transition: transform 0.1s;
  }
  #balance {
    position: absolute;
    top: 100px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 24px;
    z-index: 10;
    color: white; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –±–µ–ª—ã–π */
  }
  #user-info {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 18px;
    color: white; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –±–µ–ª—ã–π */
  }
</style>
</head>
<body>

<div id="user-info">ID: <span id="userId"></span><br>Username: <span id="username"></span></div>
<div class="coin" onclick="incrementScore()">–ù–∞–∂–º–∏ –Ω–∞ –º–µ–Ω—è</div>
<div id="balance">üí≤ 0</div>

<script>
let balance = 0;

function vibrateOnClick() {
  if ("vibrate" in navigator) {
    window.navigator.vibrate(100);
  }
}

var rainbowColors = ['#FF0000', '#FF7F00', '#FFFF00', '#00FF00', '#0000FF', '#4B0082', '#9400D3'];

function incrementScore() {
  balance++;
  document.getElementById('balance').textContent = 'üí≤' + balance;
  vibrateOnClick();

  var randomColorIndex = Math.floor(Math.random() * 7);
  document.querySelector('.coin').style.backgroundColor = rainbowColors[randomColorIndex];
}

function setInitialBalance(initialBalance) {
  balance = initialBalance;
  document.getElementById('balance').textContent = 'üí≤' + balance;
}

// –ü—Ä–∏–º–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
setInitialBalance(0);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Telegram Web App
if (window.Telegram && window.Telegram.WebApp) {
  console.log("Telegram Web App detected");
  Telegram.WebApp.expand();
  Telegram.WebApp.enableClosingConfirmation();

  const initDataUnsafe = Telegram.WebApp.initDataUnsafe;
  console.log("initDataUnsafe:", initDataUnsafe);
  if (initDataUnsafe && initDataUnsafe.user) {
    document.getElementById('userId').textContent = initDataUnsafe.user.id;
    document.getElementById('username').textContent = initDataUnsafe.user.username;

    window.Telegram.WebApp.MainButton.setParams({
      text: "–ó–∞–∫—Ä—ã—Ç—å",
      color: "rgb(77, 76, 76)",
      text_color: "#FFFFFF"
    });
    window.Telegram.WebApp.MainButton.show();

    window.Telegram.WebApp.MainButton.onClick(function() {
      save();
      window.navigator.vibrate(100);
      showConfirmationDialog();
    });
  } else {
    console.error("initDataUnsafe.user is undefined");
  }
} else {
  console.error("Telegram Web App not detected");
}

function save() {
  const initDataUnsafe = Telegram.WebApp.initDataUnsafe;
  const userid = initDataUnsafe.user.id;

  fetch('https://api.directual.com/good/api/v5/data/WebUser/saveBalance?appID=1e836900-e4dc-4f0c-b73d-fbd01d3ae652&sessionID=yourSessionID', {
    method: 'POST',
    body: JSON.stringify({
      'id': userid,
      'balance': balance
    }),
    headers: {
      'Content-Type': 'application/json'
    },
  }).then(res => res.json())
    .then(data => {
      console.log(data);
    })
    .catch(error => {
      console.error('–û—à–∏–±–∫–∞:', error);
    });
}

function showConfirmationDialog() {
  Telegram.WebApp.showConfirm("üíæ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω!\n\n–•–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –∏–≥—Ä—ã?", function(confirm) {
    if (confirm) {
      Telegram.WebApp.close();
    }
  });
}

window.addEventListener('beforeunload', function (e) {
  save();
});

setInterval(save, 5000);

// –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É
document.querySelector('.coin').addEventListener('mousedown', function(e) {
  e.preventDefault();
});
</script>

</body>
</html>
